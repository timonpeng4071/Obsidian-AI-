# AI 自动标签与属性

这是一个 Obsidian 插件，可以利用 AI 根据笔记内容或选中的文本自动生成标签和其他属性，并将这些属性添加到笔记的属性区 (Frontmatter) 中。

## 功能

- 根据笔记内容或选中的文本自动生成相关标签和属性
- 将生成的标签和属性添加到笔记的 Frontmatter 中
- 支持多种 AI 模型（OpenAI、Anthropic Claude、Azure OpenAI、Google AI、百度文心一言、讯飞星火、智谱 AI、Moonshot AI、Deepseek、OpenRouter、阿里通义千问等）
- 可配置生成标签的数量
- 支持手动触发和自动执行
- 自动清理标签中的标点符号
- 避免重复添加标签（当笔记已有5个或更多标签时）
- 支持暂停/恢复自动标签功能
- 支持保存和加载多个 API 配置
- 支持生成多种笔记属性（标签、标题、作者、日期、来源、网址、别名、摘要等）

## 手动安装

1. 下载文件包
2. 解压文件
3. 将解压后的文件夹复制到 Obsidian 插件目录（`.obsidian/plugins/`）
4. 重启 Obsidian
5. 在设置中启用插件

## 使用方法

### 手动触发

#### 生成标签

1. **右键菜单**：在编辑器中右键点击，选择"使用 AI 生成标签"
2. **命令面板**：使用命令面板（Ctrl+P）并搜索"AI 自动生成当前笔记标签"

#### 强制生成标签（忽略已有标签数量）

1. **右键菜单**：在编辑器中右键点击，选择"强制使用 AI 生成标签"
2. **命令面板**：使用命令面板（Ctrl+P）并搜索"AI 强制生成当前笔记标签"

#### 生成所有属性（标签、标题、作者等）

1. **右键菜单**：在编辑器中右键点击，选择"使用 AI 生成所有属性"
2. **命令面板**：使用命令面板（Ctrl+P）并搜索"AI 生成所有笔记属性"

如果有选中的文本，插件将根据选中的文本生成标签或属性；否则，将使用整个笔记内容。

### 自动执行

在插件设置中启用"自动执行"，并选择触发方式：

- **保存时**：在保存笔记时自动生成标签或属性
- **创建时**：在创建新笔记时自动生成标签或属性
- **修改后**：在修改笔记后自动生成标签或属性

### 暂停/恢复自动标签

如果您暂时不需要自动生成标签，可以使用以下方法暂停自动标签功能：

1. **命令面板**：使用命令面板（Ctrl+P）并搜索"暂停/恢复 AI 自动标签"
2. **设置选项卡**：在插件设置中点击"暂停自动标签"按钮

### 保存和加载 API 配置

您可以保存多个 API 配置，方便切换不同的 AI 服务和模型：

1. 在插件设置中配置 API 密钥、模型等参数
2. 点击"测试连接"按钮测试连接是否正常
3. 如果连接成功，点击"保存配置"按钮，输入配置名称
4. 保存后，您可以在"已保存的配置"列表中看到该配置
5. 点击"加载"按钮可以加载该配置
6. 点击"删除"按钮可以删除该配置

## 设置

### 基本设置

- **AI API 密钥**：输入您的 AI 服务 API 密钥
- **生成标签数量**：设置每次生成的标签数量（1-10）
- **AI 模型**：选择要使用的 AI 模型（OpenAI、Anthropic Claude、Azure OpenAI、Google AI、百度文心一言、讯飞星火、智谱 AI、Moonshot AI、Deepseek、OpenRouter、阿里通义千问等）

### API 设置

- **API 端点**：设置自定义 API 端点（可选，留空使用默认端点）
- **模型名称**：设置具体的模型名称（可选，留空使用默认模型）
- **API 版本**：设置 API 版本（可选，留空使用默认版本）
- **请求超时**：设置 API 请求超时时间（5-60 秒）

### 缓存设置

- **启用缓存**：启用/禁用缓存功能
- **缓存有效期**：设置缓存的有效期（15分钟、30分钟、1小时、2小时、1天）

### 属性设置

- **生成额外属性**：启用后，除了标签外，还会生成标题、作者、日期、来源、网址、别名和摘要等属性

### 自动执行设置

- **自动执行**：启用/禁用自动执行
- **自动执行触发方式**：选择自动执行的触发方式（保存时、创建时、修改后）
- **自动标签控制**：暂停/恢复自动标签功能

### 配置管理

- **测试 API 连接**：测试当前配置的 API 连接是否正常
- **保存配置**：保存当前 API 配置
- **已保存的配置**：管理已保存的 API 配置

## 开发

### 前提条件

- [Node.js](https://nodejs.org/)
- [npm](https://www.npmjs.com/)

### 设置开发环境

1. 克隆仓库
   ```bash
   git clone https://github.com/timonpeng4071/obsidian-ai-auto-tags.git
   ```

2. 安装依赖
   ```bash
   cd obsidian-ai-auto-tags
   npm install
   ```

3. 构建插件
   ```bash
   npm run build
   ```

4. 开发模式
   ```bash
   npm run dev
   ```

### 代码结构

- `main.ts`: 插件主文件，包含插件初始化、命令注册和设置界面
- `services/`: 服务目录
  - `aiService.ts`: AI 服务类，负责与 AI API 进行交互
  - `propertyGenerator.ts`: 属性生成类，负责生成提示和解析 AI 响应
  - `frontmatterService.ts`: Frontmatter 服务类，负责更新笔记的 Frontmatter

### 编程原则

本项目遵循以下编程原则：

1. **代码复用**：避免重复编写类似的逻辑
   - 将共用逻辑抽象为独立函数或类
   - 使用继承、组合或高阶函数减少重复代码
   - 创建通用工具函数处理常见操作

2. **一致性**：确保数据格式和处理方式一致
   - 定义统一的接口和数据结构
   - 使用统一的错误处理和返回格式
   - 保持命名和代码风格的一致性

3. **易于维护**：集中相关逻辑，便于修改和更新
   - 单一职责原则：每个类或函数只负责一个功能
   - 关注点分离：UI逻辑、业务逻辑和数据访问分离
   - 详细注释关键代码和复杂算法

4. **扩展性**：设计灵活的架构，便于添加新功能
   - 使用接口和抽象类定义行为
   - 采用模块化设计，降低组件间耦合
   - 配置驱动开发，减少硬编码

5. **简化调用**：提供简洁明了的API
   - 设计直观的函数签名和参数列表
   - 提供合理的默认值，减少必需参数
   - 封装复杂操作，提供高层次抽象

### 测试

运行单元测试：
```bash
npm test
```

## 更新日志

### 2.1.0 (2024-04-25)

- 实现了统一的属性生成类，提高代码复用性和可维护性
- 重构了 AI 服务调用逻辑，使用统一的接口调用不同的 AI 服务
- 添加了新的编程原则，指导代码设计和实现
- 整合了右键菜单，只保留一个"AI 自动添加属性"选项
- 添加了居中显示的操作确认对话框，提醒用户操作可能会影响已有属性和标签
- 优化了代码结构，遵循代码复用、一致性、易维护性、扩展性和简化调用原则
- 改进了用户体验，通过确认对话框提供更清晰的操作提示
- 修复了 `aiService.ts` 中的重复方法定义问题
- 修复了右键菜单中的功能重复问题

### 2.0.0 (2024-04-20)

- 添加了生成多种笔记属性的功能（标签、标题、作者、日期、来源、网址、别名、摘要等）
- 添加了自动清理标签中的标点符号的功能
- 添加了避免重复添加标签的功能（当笔记已有5个或更多标签时）
- 添加了暂停/恢复自动标签功能
- 添加了保存和加载多个 API 配置的功能
- 添加了更多 AI 模型的支持（Deepseek、OpenRouter、阿里通义千问等）
- 添加了请求超时设置
- 添加了缓存功能，减少重复请求
- 优化了用户界面和使用体验

### 1.0.0 (2024-XX-XX)

- 初始版本发布
- 支持根据笔记内容或选中的文本自动生成标签
- 支持多种 AI 模型（OpenAI、Anthropic Claude 等）
- 支持手动触发和自动执行

## 许可证

[MIT](LICENSE)

## 赞助

如果您觉得这个插件对您有帮助，可以考虑赞助我，以支持插件的持续开发和维护。

## 联系方式

如果您有任何问题、建议或反馈，请在 GitHub 上提交 issue 或联系我。
